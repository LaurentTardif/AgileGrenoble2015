<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">

	<head>
		<title>Google Maps</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&v=3&libraries=geometry"></script>
		<script type="text/javascript">
			
			var persistentLocation = new google.maps.LatLng(45.200793, 5.679388);
			var centerLocation = new google.maps.LatLng(46.52863469527167,2.43896484375);
			var persistentAreaRadiusInMeter = 15000;
			
			var infowindowIn;
			var infowindowOut;
			var inPresistentArea = 0;
			var outPresistentArea = 0;
			
			function updateCounters(position) {
			
				var distance = google.maps.geometry.spherical.computeDistanceBetween(persistentLocation, position);
				console.log(distance);
				if (distance < persistentAreaRadiusInMeter)
					inPresistentArea++;
				else 
					outPresistentArea++;				
			}
			
			function createMarker(googleMap, latiture, longitude) {
			
				var latlng = new google.maps.LatLng(latiture, longitude)
				//création du marqueur
				var marker = new google.maps.Marker({
					position: latlng,
					map: googleMap
				});
				
				return marker
			}
		
			function createInfoWindow(map, marker, content)
			{
				infowindow = new google.maps.InfoWindow({
					content: ""
				});			
				
				marker.addListener('click', function() {
					infowindow.open(map, marker);		
				});	

				infowindow.open(map, marker);	
				
				return infowindow;
			}
			
			function onMapClick(googleMap, latLng, inMarker, outMarker)
			{
				var marker = createMarker(googleMap, latLng.lat(), latLng.lng());
						
				updateCounters(latLng);
						
				infowindowIn.setContent("In: " + inPresistentArea);	
				infowindowOut.setContent("Out: " + outPresistentArea);	
			
			}
			
			function initializeGoogleMap() {

				//objet contenant des propriétés avec des identificateurs prédéfinis dans Google Maps permettant
				//de définir des options d'affichage de notre carte
				var options = {
					center: centerLocation,
					zoom: 6,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				
				var googleMap = new google.maps.Map(document.getElementById("carte"), options);
								
				var inMarker = createMarker(googleMap, persistentLocation.lat(), persistentLocation.lng());
			
				var outMarker = createMarker(googleMap, centerLocation.lat(), centerLocation.lng());
				
				infowindowIn = createInfoWindow(googleMap, inMarker);
				infowindowOut = createInfoWindow(googleMap, outMarker);
				
				google.maps.event.addListener(googleMap, "click", function(event) {	
						onMapClick(googleMap, event.latLng, inMarker, outMarker);
				});	

				 var inCircle = new google.maps.Circle({
									strokeColor: '#FF0000',
									strokeOpacity: 0.8,
									strokeWeight: 2,
									fillColor: '#FF0000',
									fillOpacity: 0.35,
									clickable: true,
									map: googleMap,
									center: persistentLocation,
									radius: persistentAreaRadiusInMeter
				});
				google.maps.event.addListener(inCircle, "click", function(event) {	
						onMapClick(googleMap, event.latLng, inMarker, outMarker);
				});	
				
			}				
						
		</script>
	</head>

	<body onload="initializeGoogleMap()">
		<div id="carte" style="width:100%; height:100%"></div>
	</body>
</html>